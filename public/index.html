<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Megan's Valentine's Countdown üíñ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.35/build/Tone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300&display=swap');

        body {
            background: #ffe6f0;
            padding: 20px;
            font-family: 'Poppins', sans-serif;
            text-align: center;
        }
        h1 {
            margin-bottom: 30px;
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: #d63384;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .day {
            background: linear-gradient(135deg, #ffc4d6, #ffdef5);
            border-radius: 15px;
            padding: 25px;
            font-size: 20px;
            font-weight: bold;
            color: #7d1338;
            cursor: pointer;
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, background 0.4s;
            position: relative;
        }
        .day.locked {
            background-color: #d3d3d3;
            cursor: not-allowed;
            color: #ffffff;
        }
        .solved {
            background-color: #ffdef5;
            border: 3px solid #c2185b;
        }
        .favorite-memory-input {
            margin-top: 15px;
        }
        .mood-changer {
            margin: 10px;
        }
        .mute-button {
            margin-top: 10px;
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            50% {
                transform: translateX(5px);
            }
        }
    </style>
</head>
<body>
    <h1>Megan's Valentine's Countdown üíñ</h1>
    <div class="controls">
        <button class="btn btn-warning mood-changer">üé∂ Change Mood Music</button>
        <button class="btn btn-dark mute-button">üîá Mute</button>
    </div>
    <div class="calendar"></div>

    <!-- Puzzle Modal -->
    <div class="modal fade" id="puzzleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Trivia Challenge üéÅ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="puzzle-text"></p>
                    <div class="multiple-choice-options"></div>
                    <button class="btn btn-secondary skip-question mt-3">Skip Question</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img class="event-image" alt="Event Image">
                    <p class="event-details"></p>
                    <textarea class="form-control favorite-memory-input" placeholder="Write your favorite memory of this day..." rows="3"></textarea>
                    <button class="btn btn-success save-memory mt-3">Save Memory</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let events, rules;
        let isMuted = false;
        const synth = new Tone.Synth().toDestination();
        const today = new Date();
        const currentDay = today.getDate();

        const ordinalSuffix = (day) => {
            const j = day % 10, k = day % 100;
            if (j === 1 && k !== 11) return `${day}st`;
            if (j === 2 && k !== 12) return `${day}nd`;
            if (j === 3 && k !== 13) return `${day}rd`;
            return `${day}th`;
        };

        $(document).ready(function () {
            Promise.all([
                fetch('events.json').then(res => res.json()),
                fetch('rules.json').then(res => res.json())
            ]).then(([eventsData, rulesData]) => {
                events = eventsData;
                rules = rulesData;

                for (let i = 1; i <= 14; i++) {
                    const unlocked = localStorage.getItem(`day${i}-unlocked`) === "true";
                    const formattedDate = `February ${ordinalSuffix(i)}`;
                    const isUnlockedEarly = i === 1; // Allow February 1st early
                    const dayDiv = $(`
                        <div class="day ${(isUnlockedEarly || unlocked || i <= currentDay) ? '' : 'locked'}" data-day="${i}">
                            <i class="fa-solid fa-heart"></i> ${formattedDate}
                        </div>
                    `);
                    $(".calendar").append(dayDiv);
                }

                $(".day").click(function () {
                    const day = $(this).data("day");
                    const rule = rules.find(r => r.day === day);

                    if ($(this).hasClass("locked")) {
                        $(this).addClass("shake");
                        setTimeout(() => $(this).removeClass("shake"), 500);
                        alert("This day is locked until the actual date. Come back later!");
                        return;
                    }

                    if ($(this).hasClass("solved")) {
                        showEventDetails(rule.linkedEventDate);
                    } else if (rule) {
                        $(".puzzle-text").text(rule.question);
                        $(".multiple-choice-options").empty();

                        rule.options.forEach(option => {
                            $(".multiple-choice-options").append(`
                                <button class="btn btn-outline-primary m-2 choice-option">${option}</button>
                            `);
                        });

                        $("#puzzleModal").modal("show");

                        $(".choice-option").off().click(function () {
                            const selectedOption = $(this).text();
                            if (selectedOption === rule.answer) {
                                confetti({
                                    particleCount: 200,
                                    spread: 120,
                                    origin: { y: 0.6 }
                                });
                                alert("Correct! üéâ You've unlocked the event!");
                                $(`[data-day=${day}]`).addClass("solved");
                                localStorage.setItem(`day${day}-unlocked`, "true");
                                $("#puzzleModal").modal("hide");
                                showEventDetails(rule.linkedEventDate);
                            } else {
                                alert("Oops! Try again or skip!");
                            }
                        });

                        $(".skip-question").off().click(function () {
                            $("#puzzleModal").modal("hide");
                            alert("No worries! Moving on to the next challenge! üåü");
                        });
                    }
                });

                function showEventDetails(eventDate) {
                    const event = events.find(e => e.date === eventDate);
                    if (event) {
                        $(".modal-title").text(event.title);
                        $(".event-image").attr("src", event.image);
                        $(".event-details").html(event.details);
                        const memoryKey = `${eventDate}-memory`;
                        $(".favorite-memory-input").val(localStorage.getItem(memoryKey) || "");
                        $("#eventModal").modal("show");

                        $(".save-memory").off().click(function () {
                            const memory = $(".favorite-memory-input").val().trim();
                            localStorage.setItem(memoryKey, memory);
                            confetti({ particleCount: 300, spread: 160, origin: { y: 0.4 } });
                            alert("Memory saved! ‚ù§Ô∏è");
                        });
                    }
                }

                $(".mood-changer").click(function () {
                    if (!isMuted) {
                        const notes = ["C4", "E4", "G4", "B4"];
                        let index = 0;
                        const playNote = () => {
                            if (!isMuted) {
                                synth.triggerAttackRelease(notes[index], "8n");
                                index = (index + 1) % notes.length;
                                setTimeout(playNote, 1000);
                            }
                        };
                        playNote();
                        confetti({ particleCount: 400, spread: 150 });
                    }
                });

                $(".mute-button").click(function () {
                    isMuted = !isMuted;
                    $(this).text(isMuted ? "üîä Unmute" : "üîá Mute");
                });
            });
        });
    </script>
</body>
</html>
